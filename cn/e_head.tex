%两个quad空格	a \qquad b
%quad空格	a \quad b
%大空格		a\ b
%中等空格	a\;b
%小空格		a\,b
%没有空格	ab
%紧贴		a\!b

% 页码
\definestructureconversionset[frontpart:pagenumber][][romannumerals]
\definestructureconversionset [bodypart:pagenumber][][numbers]
\definestructureconversionset [appendix:pagenumber][][numbers]
\definestructureconversionset [backpart:pagenumber][][numbers]
\setuppagenumber[numberconverionset=pagenumber]

% 用來控制章节編號的復位 part、chapter獨立編號，section則每章重新編號
\definestructureresetset[frontpart:default][0,0,1][0] % don't reset part, chapter, but section
\definestructureresetset [bodypart:default][0,0,1][0] % don't reset part, chapter, but section
\definestructureresetset [appendix:default][0,0,1][0] % don't reset part, chapter, but section
\definestructureresetset [backpart:default][0,0,1][0] % don't reset part, chapter, but section
\setuphead[sectionresetset=default]

% 用來控制編號格式
\definestructureconversionset[frontpart:sectionnumber][][]
\definestructureconversionset [bodypart:sectionnumber][chinesecapnumerals, numbers, numbers][numbers]
\definestructureconversionset [appendix:sectionnumber][chinesecapnumerals, Characters, numbers][numbers]
\definestructureconversionset [backpart:sectionnumber][][]
\setuphead[sectionconversionset=sectionnumber]

% 用來控制章节編號間的串聯
% can't remove partnumber
%\definestructureprefixset [myset] [section-1,section-2,section-3,section-4,section-5,section-6][]
%\setuphead[sectionset=myset]
\setuphead[part][sectionsegments=1]
\setuphead[chapter][sectionsegments=2:*]
\setuphead[section][sectionsegments=2:*]
\setuphead[subsection][sectionsegments=2:*]
\setuphead[subsubsection][sectionsegments=2:*]
\setuphead[subsubsubsection][sectionsegments=2:*]

% 用來控制編號間隔符
\defineseparatorset[frontpart:sepset][!,.,.][.]
\defineseparatorset [bodypart:sepset][!,.,.][.]
\defineseparatorset [appendix:sepset][!,-,.][.]
\defineseparatorset [backpart:sepset][!,.,.][.]
\setuphead[sectionseparatorset=sepset]

% 用來控制label
\setuphead[part][
  frontpartlabel=frontpart,
  bodypartlabel=bodypart,
  appendixlabel=appendpart,
  backpartlabel=backpart,
]
\setuphead[chapter][
  frontpartlabel=frontchapter,
  bodypartlabel=bodychapter,
  appendixlabel=appendchapter,
  backpartlabel=backchapter,
]
\setuphead[section][
  frontpartlabel=frontsection,
  bodypartlabel=bodysection,
  appendixlabel=appendsection,
  backpartlabel=backsection,
]

\setuphead[part][
  textstyle=parttext, %normal bold slanted boldslanted % 標題內容
  numberstyle=parttext, %normal bold slanted boldslanted % 編號
%  numbercommand=\PartNbr,
  header=high, %none empty high nomarking %章节首頁無頁眉
  footer=high, %none empty high nomarking
  before={\blank[2ex]}, %COMMAND
  after={\blank[1ex] \placelist[chapter]}, %COMMAND
  alternative=middle, %normal inmargin middle TEXT
  placehead=yes,
]

\setuphead[chapter][
  indentnext=yes,
  textstyle=chaptertext, %normal bold slanted boldslanted % 標題內容
  numberstyle=chaptertext, %normal bold slanted boldslanted % 編號
  number=yes, %yes no % 是否帶編號
  ownnumber=no, %yes no % 是否指定編號，如果是，則第一個參數就是編號
  page=yes, %left right yes % 是否固定於左頁或右頁
%  continue=no, %yes no % 第一個是否緊接上一層，優先於*page*
  header=high, %none empty high nomarking %章节首頁無頁眉
%  text=nomarking, %none empty high nomarking
  footer=high, %none empty high nomarking
  before={\blank[2ex]}, %COMMAND
%  inbetween=, %COMMAND
  after={\blank[2ex] \placecontent \blank[2ex]}, %COMMAND
  alternative=middle, %normal inmargin middle TEXT
%  sectionnumber=no,
]

\setuphead[section][
  indentnext=yes,
  textstyle=sectiontext, %normal bold slanted boldslanted % 標題內容
  numberstyle=sectiontext, %normal bold slanted boldslanted % 編號
  number=yes, %yes no % 是否帶編號
  ownnumber=no, %yes no % 是否指定編號，如果是，則第一個參數就是編號
  before={\blank[1.5ex]}, %COMMAND
  after={\blank[1ex]}, %COMMAND
  alternative=inmargin, %normal inmargin middle TEXT
]

\setuphead[subsection][
  indentnext=yes,
  textstyle=subsectiontext, %normal bold slanted boldslanted % 標題內容
  numberstyle=subsectiontext, %normal bold slanted boldslanted % 編號
  number=yes, %yes no % 是否帶編號
  ownnumber=no, %yes no % 是否指定編號，如果是，則第一個參數就是編號
  before={\blank[1ex]}, %COMMAND
  after={\blank[1ex]}, %COMMAND
  alternative=inmargin, %normal inmargin middle TEXT
]

\setuphead[subsubsection][
  indentnext=yes,
  textstyle=subsubsectiontext, %normal bold slanted boldslanted % 標題內容
  numberstyle=subsubsectiontext, %normal bold slanted boldslanted % 編號
  number=yes, %yes no % 是否帶編號
  ownnumber=no, %yes no % 是否指定編號，如果是，則第一個參數就是編號
  before={\blank[.5ex]}, %COMMAND
  after={\blank[.5ex]}, %COMMAND
  alternative=inmargin, %normal inmargin middle TEXT
]

%list the "subject" in the ToC but don't modify the "section" counter:
\setuphead[subject][
  incrementnumber=list,
]

\setuphead[title][
  indentnext=yes,
  textstyle=titletext, %normal bold slanted boldslanted % 標題內容
  page=yes, %left right yes % 是否固定於左頁或右頁
  continue=no, %yes no % 第一個是否緊接上一層，優先於*page*
  header=high, %none empty high nomarking %章節首頁無頁眉
%  text=nomarking, %none empty high nomarking
  footer=normal, %none empty high nomarking
  before={\blank[2ex]}, %COMMAND
%  inbetween=, %COMMAND
  after={\blank[1ex]}, %COMMAND
  alternative=middle, %normal inmargin middle TEXT
  sectionnumber=no,
]

\setuplist[
  alternative=c,	%a 空格
			%b 右对齐
			%c ...page
			%d 大空格　紧接下一个list
			%e 编号加方框，标题向左缩
			%f
			%g 标题居中... none command
  %label=yes,		% bug： 如果設置此項，則編譯參考文獻時會失敗
  interaction=all,
%  aligntitle=yes,
%  align=flushleft,
]

\setuplist[part][
  width=4em,	% setuplist中的設置無效，可能是bug
  margin=0em,	%dimension % 左侧缩进
  label=yes,
  style=bold,
]

\setuplist[chapter][
  width=4em,	% setuplist中的設置無效，可能是bug
  margin=0em,	%dimension % 左侧缩进
  label=yes,
]

\setuplist[section][
  width=4em,
  margin=2em,	%dimension % 左侧缩进
  label=yes,
]

\setuplist[subject][
  width=4em,
  margin=2em,	%dimension % 左侧缩进
  label=yes,
]

\setuplist[figure][
  width=4em,
  label=figure, % label=yes 無效，這可能是bug
  margin=0em,	%dimension % 左侧缩进
]

\setuplist[table][
  width=4em,
  label=table, % label=yes 無效，這可能是bug
  margin=0em,	%dimension % 左侧缩进
]

% 显示目录
% \completecontent % with title
% \placecontent % without title
\setupcombinedlist[content][
  list={chapter,section,subsection}% @todo 必须加%，可能是bug
]
\definecombinedlist[figures][figure][
  %criterium=all%
]
\definecombinedlist[tables][table][
  %criterium=all%
]

\let\stdcompletefigures\completefigures
\def\completefigures{%
  \determinelistcharacteristics[figure]
  \doifmode{*list}{
    \stdcompletefigures%
  }
}
\let\stdcompletetables\completetables
\def\completetables{%
  \determinelistcharacteristics[table]
  \doifmode{*list}{
    \stdcompletetables%
  }
}
